# Quantum-Aero F1 Multi-Agent System**AI-Native Aerodynamic Optimization powered by Claude AI and Agentcy Framework**This directory contains the implementation of the multi-agent system that powers the Q-Aero platform with intelligent, conversational aerodynamic optimization capabilities.---## ­ƒÄ» OverviewThe Q-Aero multi-agent system consists of **8 specialized Claude AI agents** that work together to solve complex aerodynamic optimization problems:1. **Master Orchestrator** - Coordinates all agents and maintains conversation context2. **Intent Router** - Routes tasks to appropriate specialized agents3. **Aerodynamics Agent** - CFD simulation analysis and interpretation4. **ML Surrogate Agent** - Fast ML-based predictions with confidence assessment5. **Quantum Optimizer Agent** - Quantum-enhanced design optimization6. **Physics Validator Agent** - Physics-based validation of ML predictions7. **Visualization Agent** - Result visualization and insight extraction8. **Analysis Agent** - Trade-off analysis and recommendations---## ­ƒÅù´©Å Architecture```ÔöîÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÉÔöé                    User Interface                        ÔöéÔöé               (React + Claude Chat)                      ÔöéÔööÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔö¼ÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÿ                   Ôöé                   Ôû╝ÔöîÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÉÔöé            Master Orchestrator Agent                     ÔöéÔöé              (Claude Sonnet 4.5)                         ÔöéÔööÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔö¼ÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÿ                   Ôöé         ÔöîÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔö┤ÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÉ         Ôöé   NATS Pub-Sub    Ôöé         Ôöé   SLIM Transport  Ôöé         ÔööÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔö¼ÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÿ                   Ôöé    ÔöîÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔö╝ÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÉ    Ôû╝              Ôû╝              Ôû╝ÔöîÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÉ   ÔöîÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÉ   ÔöîÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÉÔöéML AgentÔöé   ÔöéPhysics  Ôöé   ÔöéQuantum   ÔöéÔöé(Haiku) Ôöé   ÔöéAgent    Ôöé   ÔöéAgent     ÔöéÔööÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÿ   ÔööÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÿ   ÔööÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÿ    Ôöé              Ôöé              Ôöé    ÔööÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔö╝ÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÿ                   Ôû╝         ÔöîÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÉ         Ôöé  ML/Physics/    Ôöé         Ôöé  Quantum        Ôöé         Ôöé  Services       Ôöé         ÔööÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÇÔöÿ```---## ­ƒÜÇ Quick Start### 1. Prerequisites- Python 3.11+- Docker & Docker Compose- Anthropic API key- NATS server (included in docker-compose)### 2. Installation```bash# Install Python dependenciescd agentspip install -r requirements.txt# Configure environmentcp .env.example .env# Edit .env and add your ANTHROPIC_API_KEY```### 3. Start Infrastructure```bash# Start NATS, databases, and observability stackdocker-compose -f docker-compose.agents.yml up -d nats mongodb redis qdrant prometheus grafana```### 4. Run Agents Locally (Development)```bash# Terminal 1: Master Orchestratorpython -m agents.master_orchestrator.agent# Terminal 2: ML Surrogate Agentpython -m agents.ml_surrogate.agent# Terminal 3: Add more agents as needed```### 5. Run Agents with Docker (Production)```bash# Build and start all agentsdocker-compose -f docker-compose.agents.yml up --build# Or start specific agentsdocker-compose -f docker-compose.agents.yml up master-orchestrator ml-agent```---## ­ƒôé Directory Structure```agents/Ôö£ÔöÇÔöÇ config/Ôöé   ÔööÔöÇÔöÇ config.py                    # Centralized configurationÔö£ÔöÇÔöÇ utils/Ôöé   Ôö£ÔöÇÔöÇ anthropic_client.py          # Claude API clientÔöé   ÔööÔöÇÔöÇ nats_client.py               # NATS messaging clientÔö£ÔöÇÔöÇ master_orchestrator/Ôöé   Ôö£ÔöÇÔöÇ agent.py                     # Master orchestrator implementationÔöé   ÔööÔöÇÔöÇ DockerfileÔö£ÔöÇÔöÇ ml_surrogate/Ôöé   Ôö£ÔöÇÔöÇ agent.py                     # ML surrogate implementationÔöé   ÔööÔöÇÔöÇ DockerfileÔö£ÔöÇÔöÇ quantum_optimizer/Ôöé   Ôö£ÔöÇÔöÇ agent.py                     # Quantum optimizer (to be implemented)Ôöé   ÔööÔöÇÔöÇ DockerfileÔö£ÔöÇÔöÇ physics_validator/Ôöé   Ôö£ÔöÇÔöÇ agent.py                     # Physics validator (to be implemented)Ôöé   ÔööÔöÇÔöÇ DockerfileÔö£ÔöÇÔöÇ analysis/Ôöé   Ôö£ÔöÇÔöÇ agent.py                     # Analysis agent (to be implemented)Ôöé   ÔööÔöÇÔöÇ DockerfileÔö£ÔöÇÔöÇ mcp_servers/Ôöé   Ôö£ÔöÇÔöÇ mesh_database_server.py      # MCP server for mesh accessÔöé   ÔööÔöÇÔöÇ simulation_history_server.py # MCP server for simulation historyÔö£ÔöÇÔöÇ workflows/Ôöé   ÔööÔöÇÔöÇ optimization_workflow.py     # LangGraph workflowsÔö£ÔöÇÔöÇ observability/Ôöé   Ôö£ÔöÇÔöÇ otel-collector-config.yaml   # OpenTelemetry configÔöé   Ôö£ÔöÇÔöÇ prometheus.yml               # Prometheus configÔöé   ÔööÔöÇÔöÇ grafana-dashboards/          # Grafana dashboardsÔö£ÔöÇÔöÇ requirements.txtÔö£ÔöÇÔöÇ .env.exampleÔööÔöÇÔöÇ README.md (this file)```---## ­ƒöº Configuration### Environment VariablesSee `.env.example` for all available configuration options:```bash# CoreANTHROPIC_API_KEY=sk-ant-your-key-here# InfrastructureNATS_URL=nats://localhost:4222MONGODB_URI=mongodb://localhost:27017/qaeroREDIS_URL=redis://localhost:6379# ServicesML_SERVICE_URL=http://localhost:8000PHYSICS_SERVICE_URL=http://localhost:8001QUANTUM_SERVICE_URL=http://localhost:8002```### Agent ConfigurationAgent-specific configuration is in `config/config.py`:```pythonAGENT_MODELS = {    "master_orchestrator": {        "model": "claude-sonnet-4.5-20250929",        "temperature": 0.2,        "max_tokens": 4096,    },    "ml_surrogate": {        "model": "claude-haiku-4-20250514",  # Fast & cost-efficient        "temperature": 0.1,        "max_tokens": 2048,    },    # ... more agents}```---## ­ƒÆ¼ Usage Examples### Example 1: Query Master Orchestrator```pythonfrom agents.master_orchestrator.agent import MasterOrchestratorAgentagent = MasterOrchestratorAgent()await agent.start()# Stream responseasync for chunk in agent.process_query(    "Optimize this wing for maximum downforce at Monza",    context={"mesh_id": "wing_v3.2", "velocity": 250}):    print(chunk, end="", flush=True)```### Example 2: Request ML Prediction via NATS```pythonfrom agents.utils.nats_client import NATSClientnats = NATSClient()await nats.connect()response = await nats.request(    "agent.ml.predict",    {        "mesh_id": "wing_v3.2",        "parameters": {"velocity": 250, "yaw": 0},        "model_preference": "auto"    },    timeout=10.0)print(f"Prediction: Cl={response['prediction']['Cl']:.2f}")print(f"Confidence: {response['confidence']:.2f}")```### Example 3: Full Optimization Workflow```pythonfrom agents.workflows.optimization_workflow import run_optimization_workflowresult = await run_optimization_workflow(    user_query="Optimize for Monza high-speed track",    mesh_id="wing_v6.3")print(f"Optimal config: {result['optimal_config']}")print(f"Expected downforce gain: {result['analysis']['improvements']['downforce_gain']}%")```---## ­ƒº¬ Testing### Unit Tests```bashpytest agents/tests/```### Integration Tests```bash# Ensure NATS is runningdocker-compose -f docker-compose.agents.yml up -d nats# Run integration testspytest agents/tests/integration/```### Manual Testing with NATS CLI```bash# Install NATS CLIbrew install nats-io/nats-tools/nats# Subscribe to agent eventsnats sub "events.>"# Publish test requestnats req agent.ml.predict '{"mesh_id": "wing_test", "parameters": {"velocity": 250}}'```---## ­ƒôè Monitoring & Observability### Prometheus MetricsAccess at: `http://localhost:9090`Key metrics:- `agent_requests_total` - Total requests per agent- `agent_request_duration_seconds` - Request latency- `agent_errors_total` - Error count- `claude_api_calls_total` - Claude API usage- `claude_tokens_used_total` - Token consumption### Grafana DashboardsAccess at: `http://localhost:3001` (default: admin/admin)Pre-configured dashboards:1. **Agent Performance** - Request latency, throughput, errors2. **Claude API Usage** - API calls, token usage, cost tracking3. **NATS Messaging** - Message queue depth, pub-sub latency4. **System Health** - Agent status, resource usage### OpenTelemetry TracingAll agent interactions are traced with OpenTelemetry:```pythonfrom agents.observability.tracer import tracer@tracer.start_as_current_span("ml_agent_inference")async def predict(mesh_id, parameters):    # Automatically traced    result = await ml_service.predict(mesh_id, parameters)    return result```View traces in Grafana with Tempo or Jaeger integration.---## ­ƒÆ░ Cost Optimization### Token Usage Estimates| Agent | Model | Tokens/Request | Cost/Request | Usage Pattern ||-------|-------|----------------|--------------|---------------|| Master Orchestrator | Sonnet 4.5 | ~2,000 | $0.012 | Every user query || ML Agent | Haiku | ~500 | $0.00125 | High frequency || Quantum Agent | Sonnet 4.5 | ~1,500 | $0.009 | Optimization only || Analysis Agent | Sonnet 4.5 | ~3,000 | $0.018 | Final synthesis |**Estimated Monthly Cost:** ~$560 for 3,500 interactions/day### Optimization Strategies1. **Use Haiku for simple tasks** - ML agent uses Haiku for 60% cost savings2. **Cache frequent queries** - Redis caching reduces redundant API calls3. **Batch requests** - Process multiple predictions in one call4. **Prompt compression** - Use concise system prompts5. **Conditional agent calls** - Only invoke agents when necessary---## ­ƒöÉ Security### API Key Management```bash# Use environment variables (never commit)export ANTHROPIC_API_KEY=sk-ant-...# Or use secret managementkubectl create secret generic anthropic-key \  --from-literal=ANTHROPIC_API_KEY=sk-ant-...```### NATS Authentication```yaml# nats.confauthorization {  users = [    {user: "qaero", password: "$NATS_PASSWORD"}  ]}```### Network Security- Agents communicate only via internal `qaero-agent-network`- External access only through NGINX reverse proxy- TLS/SSL for all external connections---## ­ƒÉø Troubleshooting### Agent Not Starting```bash# Check logsdocker-compose -f docker-compose.agents.yml logs master-orchestrator# Verify NATS connectiondocker-compose -f docker-compose.agents.yml exec nats nats server info# Check environment variablesdocker-compose -f docker-compose.agents.yml exec master-orchestrator env | grep ANTHROPIC```### Claude API Errors```bash# Rate limit exceeded# Solution: Implement exponential backoff (already in anthropic_client.py)# Invalid API key# Solution: Verify ANTHROPIC_API_KEY in .env# Context length exceeded# Solution: Reduce conversation history (kept to last 20 messages)```### NATS Connection Issues```bash# Check NATS statusdocker-compose -f docker-compose.agents.yml ps nats# Test connectionnats account info --server=nats://localhost:4222# Monitor messagesnats sub ">" --server=nats://localhost:4222```---## ­ƒôÜ Additional Resources- **Main Documentation:** See `/Quantum Aero F1 Prototype GENAI Claude BOOSTED.md`- **Agentcy Framework:** https://github.com/rjamoriz/Agentcy-Multiagents- **Anthropic Claude:** https://docs.anthropic.com/claude/docs- **LangGraph:** https://langchain-ai.github.io/langgraph/- **NATS Messaging:** https://docs.nats.io/---## ­ƒñØ ContributingWhen adding new agents:1. Create agent directory: `agents/{agent_name}/`2. Implement `agent.py` with proper system prompt3. Add Dockerfile following existing pattern4. Update `config/config.py` with agent configuration5. Add to `docker-compose.agents.yml`6. Update this README---## ­ƒôØ LicensePart of the Quantum-Aero F1 Prototype project.---**Built with ÔØñ´©Å using Claude AI, Agentcy, and LangGraph**